<!--
8"""8 8"""" 8"""8  8""""8 8""""8   8   8 8""""8 8""""
8   8 8     8   8  8    8 8    8   8   8 8    8 8
8e  8 8eeee 8eee8e 8e   8 8eeee8ee 8e  8 8e   8 8eeee
88  8 88    88   8 88   8 88     8 88  8 88   8 88
88  8 88    88   8 88   8 88     8 88  8 88   8 88
88  8 88eee 88   8 88eee8 88eeeee8 88ee8 88eee8 88eee

[website] https://www.nerdbude.com
[mail] post@nerdbude.com
[twitter] @PH_0x17
[github] https://www.github.com/nerdbude
 -->

<!DOCTYPE html>
<html>
<head>
    <title>NERDBUDE</title>
    <meta charset="utf-8" />
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@PH_0x17">

    <meta property="og:url" content="https://www.nerdbude.com/nixos.html">
    <meta property="og:title" content="nixOS">
    <meta property="og:description" content="Nach 15 Jahren Debian wird es mal Zeit für etwas neues, nämlich nixOS. Noch nie hab ich ein OS so geliebt und gehasst.">

    <meta property="og:image" content="https://www.nerdbude.com/images/fav.png">
    <link rel="icon" type="image/png" href="https://www.nerdbude.com/images/fav.png">
    <link rel="alternate" href="https://nerdbude.com/rss/rss.xml" type="application/rss+xml" title="NERDBUDE"/>
    <link rel="stylesheet" type="text/css" href="css/style.css" media="screen">
</head>

<body>

	<!--- HEADER -->
  <header>
    <div id="headerimage">
      <h1><a href="https://www.nerdbude.com" class="front">[$nb]</a></h1>
      <table>
	      <tr>
		      <th><a href="https://www.nerdbude.com/readme.html" class="front">[+]readme.txt</a></th>
          <th><a href="https://www.nerdbude.com/about.html" class="front">[+]aboutme.txt</a></th>
          <th><a href="https://www.nerdbude.com/podcast/index.html" class="front">[+]podcast.txt</a></th>
	      </tr>
      </table>
    </div>
  </header>

  <div id="content">
<!-- ARTIKLE START -->
<h2>nixOS</h2>
Seit nun mehr 15 Jahren (shit bin ich alt) bin ich treuer Debian User.<br>
Wer sein System schon mal neu aufsetzen musste und das hab ich in den 15 Jahren doch das ein oder andere Mal machen müssen, der weiß wie nervig es sein kann sein System wieder auf den Stand zu bringen wie davor.<br>
Filebackups ist das eine, das System selber ist aber ein anderes Blatt.<br>
Da aus Neugier öfter mal was neues ausprobiert werden muss kam also nixOS ins Spiel.<br>
Ursprünglich stand Arch Linux zur Auswahl aber durch einen kleinen Tipp bin ich dann direkt zu nixOS gewechselt.<br>
Der Installations-Aufwand ist im Grunde ähnlich wie bei Arch-Linux, also pure Handarbeit inkl. händischer Formatierung und Partitionierung der Festplatte, und Installation des Systems von Grund auf.<br>
Die Installationsanleitung gibt es auf <a href="http://nixos.org">https://nixos.org</a> und ist wirklich sehr einfach und übersichtlich.<br>
<br>
Warum will man dann nixOS haben?<br>
Mittlerweile will ich ein System haben, dass so minimalistisch wie möglich daher kommt.<br>
Klar Debian kann als pure "minimalistische" Installation hergenommen werden, hat aber dennoch Pakete die übermäßig groß sind und unnötig Platz fressen.<br>
Die Pakete haben selbstverständlich unter Debian ihre Daseinsberechtigungen aber ob man die haben will ist eine andere sache.<br>
<br>
nixOS belegt ungefähr 1.5GB.<br>
Das ist ordentlich schlank und auch interessant für ältere Hardware.<br>
Als WM kommt hier natürlich auch wieder XMonad drauf. Spart auch Platz und meine Finger haben sich schon daran gewöhnt.<br>
<br>
Neben dem Vorteil der Größe ist aber noch ein anderer Punkt ausschlaggebend für meine Entscheidung.<br>
nixOS selber nennt drei Hauptvorteile: reproducible, declarativ und reliable.<br>
<br>
Reproducable: Die nix Pakete sind isoliert von einander, das stellt sicher, dass sie reproduzierbar sind und keine nicht deklarierten Dependencies hat. Funktioniert ein Paket auf einem Rechner, funktioniert es auch auf einem anderen.<br>
Declarativ: Mit nixOS kann man Entwicklungsumgebungen freigeben unabhängig davon welche Sprache oder Tools.<br>
Reliable: Durch die Installation eines Paketes werden keine anderen beschädigt. Man kann ein Rollback auf frühere Versionen durchführen und sicherstellen, dass sich während eines Upgrades kein Paket in einem inkonsistenten Zustand befindet.<br>
<br> 
Im absoluten Minimum ist nixOS komplett reproducable aus einer einzigen config-file.<br>
Die magische "configuration.nix".<br>
In diesem File werden einerseits das gesamte System konfiguriert und alle nötigen Pakete, wie Sound, Wifi, WM usw. hinterlegt aber auch Programme wie Vim, Git, Python, GoAccess und alles was man braucht.<br>
Das heißt im Umkehrschluss, wenn man ein nixOS auf einem anderen Rechner installiert und die "configuration.nix" extern gebackuped hat, kopiert man sich diese auf das neue System startet einen Rebuild und hat sein bisheriges System wieder hergestellt.<br>
Einfacher geht es nicht. Kein lässtiges installieren von Hand mehr.<br>
<br>
Wenn man nixOS auf einem gleichen System wie dem Vorherigen laufen lassen möchte, gibt es auch noch die Möglichkeit sämtliche Hardwarespezifikationen in der "hardware-configuration.nix" zu hinterlegen.<br>
Würde beispielsweise mein T470 hier den Geist aufgeben und ich mir wieder ein T470 zulegen würde (kein so abwegiger Gedanke), bräuchte ich nur die "configuration.nix" und die "hardware-configuration.nix" Files und hätte innerhalb von wenigen Minuten mein System sofort wieder einsatzbereit.<br>
Das einzige was dann noch händisch drauf gepackt werden muss sind die dotfiles der einzelnen Programme.<br>
Da bin ich aber dran und das gibt dann nen separaten Blogpost.<br>
<br>
<h3>Installation</h3>
Wie installiert man nixOS:<br>
<br>
Als allererstes holt man sich die aktuelle nixOS ISO-File hier: <a href="https://nixos.org/download.html">https://nixos.org/download</a><br>
<br>
Die iso packt man sich auf einen USB-Stick oder irgendein bootfähiges Medium. (Ich hatte <a href="https://www.nerdbude.com/sd_card.html">HIER</a> mal erklärt. Ob SD-Karte oder USB Stick ist dabei egal).<br>
Danach bootet man vom Stick.<br>
Wenn alles geklappt hat, dann wird man begrüßt von einer Shell.<br>
Standartlogin ist User:nixos mit leerem Passwort.<br>
<br>
Als allererstes empfiehlt es sich das Keyboardlayout festzulegen:<br>
<br>
<span class="label">CONSOLE</span>
<div id="cssyn">
<pre>
<ln><span class="unixshell">loadkeys de de</span></ln>
</pre>
</div>
<br>
<br>
Das würde das Layout auf deutsch wechseln.<br>
<br>
Weiter gehts mit der Partitionierung der Festplatte.<br>
Das geht einmal mit UEFI und einmal mit MBR.<br>
Im Beispiel hier ist die Platte als /sda eingehängt.<br>
<br>
UEFI<br>
<br>
<span class="label">CONSOLE</span>
<div id="cssyn">
<pre>
<ln><span class="unixshell">parted /dev/sda -- mklabel gpt</span></ln>
<ln><span class="unixshell">parted /dev/sda -- mkpart primary 512MiB -8GiB</span></ln>
<ln><span class="unixshell">parted /dev/sda -- mkpart primary linux-swap -8GiB 100%</span></ln>
<ln><span class="unixshell">parted /dev/sda -- mkpart ESP fat32 1MiB 512MiB</span></ln>
<ln><span class="unixshell">parted /dev/sda -- set 3 esp on</span></ln>
</pre>
</div>
<br>
<br>
Hier werden Root und Swap Partition angelegt.<br>
<br>
<br>
MBR<br>
<br>
<span class="label">CONSOLE</span>
<div id="cssyn">
<pre>
<ln><span class="unixshell">parted /dev/sda -- mklabel msdos</span></ln>
<ln><span class="unixshell">parted /dev/sda -- mkpart primary 1MiB -8GiB</span></ln>
<ln><span class="unixshell">parted /dev/sda -- mkpart primary linux-swap -8GiB 100%</span></ln>
</pre>
</div>
<br>
<br>
Weiter gehts mit dem Filesystem.<br>
nixOS bietet verschiedene Filesysteme an.<br>
<br>
<span class="label">Ext4</span>
<div id="cssyn">
<pre>
<ln><span class="unixshell">mkfs.ext4 -L nixos /dev/sda1</span></ln>
</pre>
</div>
<br>
<br>
<span class="label">Swap</span>
<div id="cssyn">
<pre>
<ln><span class="unixshell">mkswap -L swap /dev/sda2</span></ln>
</pre>
</div>
<br>
<br>
<span class="label">FAT</span>
<div id="cssyn">
<pre>
<ln><span class="unixshell">mkfs.fat -F 32 -n boot /dev/sda3</span></ln>
</pre>
</div>
<br>
<br>
<span class="label">RAID</span>
<div id="cssyn">
<pre>
<ln><span class="unixshell">mdadm</span></ln>
</pre>
</div>
<br>
<br>
Letzter Schritt - die finale Installation.<br>
Zuerst wird das Laufwerk gemounted:<br>
<br>
<br>
<span class="label">MOUNT</span>
<div id="cssyn">
<pre>
<ln><span class="unixshell">mount /dev/disk/by-label/nixos /mnt</span></ln>
</pre>
</div>
<br>
<br>
Unter UEFI Systemen läuft das ein wenig anders ab:<br>
<br>
<br>
<span class="label">MOUNT</span>
<div id="cssyn">
<pre>
<ln><span class="unixshell">mkdir -p /mnt/boot</span></ln>
<ln><span class="unixshell">mount /dev/disk/by-label/boot /mnt/boot</span></ln>
</pre>
</div>
<br>
<br>
Wenn das alles erledigt ist, wird die vorhin erwähnte configuration.nix file angelegt.<br>
Das geht bequem per Befehl.<br>
<br>
<br>
<span class="label">CREATE CONFIG</span>
<div id="cssyn">
<pre>
<ln><span class="unixshell">nixos-generate-config --root /mnt</span></ln>
</pre>
</div>
<br>
<br>
Nun kann man entweder seine bereits vorhandene configfile hier einsetzen oder belässt die neue configfile, wenn man neu starten möchte.<br>
In jedemfall lohnt es sich die "configuration.nix" vor dem nächsten Schritt anzuschauen, da es sonst sein kann, dass nixOS nicht bootet.<br>
<br>
Der nächste Schritt ist die Installation.<br>
<br>
<br>
<span class="label">INSTALLATION</span>
<div id="cssyn">
<pre>
<ln><span class="unixshell">nixos-install</span></ln>
</pre>
</div>
<br>
<br>
Nun rattert nixOS durch bis alles nötige installiert ist. Zwischdrin wird noch ein root-passwort vergeben und wenn alles geklappt hat könnt ihr rebooten und habt ein wundervolles OS auf dem Rechner.<br>
<br>
Soweit wäre das Grundsystem fertig und weitestgehend benutzbar.<br>
<br>
<h3>Software</h3>
Nun will man aber noch 'nen WM haben, Python, Vim und und und.<br>
Es gibt zwei Möglichkeiten Programme oder Pakete zu installieren.<br>
<br>
Zum einen lassen sich Pakete lokal, in dem Sinn nur für das aktuelle System installieren:<br>
<br>
<br>
<span class="label">local</span>
<div id="cssyn">
<pre>
<ln><span class="unixshell">nix-env -iA nixos.vim</span></ln>
</pre>
</div>
<br>
<br>
Der Befehl würde Vim für den aktuellen User installieren.<br>
Das empfiehlt sich allerdings eher zum testen des Pakets, da Vim in diesem Fall nicht in der "configuration.nix" liegt und beim reproduzieren des Systems nicht mit installiert wird.<br>
Um Vim beim Transfer des Systems mit drin zu haben, muss Vim mit in die "configuration.nix".<br>
<br>
<br>
<span class="label">configuration.nix</span>
<div id="cssyn">
<pre>
<ln><span class="unixshell">environment.systemPackages = with pkgs; [</span></ln>
<ln><span class="unixshell">vim</span></ln>
<ln><span class="unixshell">   ];</span></ln>
</pre>
</div>
<br>
<br>
Dieser Eintrag muss in die "configuration.nix", damit beim Neuaufsetzen Vim mit installiert wird.<br>
Nachdem Vim im configfile eingetragen ist, muss ein rebuild ausgeführt werden.<br>
<br>
<br>
<span class="label">Rebuild</span>
<div id="cssyn">
<pre>
<ln><span class="unixshell">nixos-rebuild switch</span></ln>
</pre>
</div>
<br>
<br>
Dann hat man die, in der configuration.nix file hinterlegte config.<br>
<br>
Das sind die Grundlagen um nixOS zum laufen zu bringen, zu mindest als grundlegendes System.<br>
<br>
<br>
Über die configuration.nix file oder auch andere nixOS Themen werd ich in Zukunft noch den ein oder anderen Post raushauen.<br>
nixOS ist mit Sicherheit kein OS für jeden Menschen aber wenn man es mal hat will man es eigentlich auch nicht mehr missen.<br>
Ausprobieren lohnt sich allemale.<br>
<!-- ARTIKEL ENDE -->
<br>
<br>
<br>
<br>
<p>//EOF</p>
  </div>

  <!-- Footer -->

  <div id="footer">
    <a href="https://www.nerdbude.com/impressum.html">./impressum </a>
    <a target="_blank" href="https://www.nerdbude.com/datenschutz.html">./datenschutz </a>
  </div>

</body>
</html>
